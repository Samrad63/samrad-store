<!DOCTYPE html>
<html lang="fa">
  <head>
    <meta charset="UTF-8" />
    <title>سبد خرید</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
    />
    <link rel="stylesheet" href="/css/cart.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center me-auto" href="index.html">
      <img src="images/samrad_logo.jpg" alt="سام‌راد" width="195" height="60" />
    </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">خانه</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="cart.html">سبد خرید</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="checkout.html">ثبت سفارش</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <h2>سبد خرید شما</h2>
      <table class="table table-bordered mt-4">
        <thead>
          <tr>
            <th>نام محصول</th>
            <th>تعداد</th>
            <th>قیمت واحد</th>
            <th>جمع</th>
            <th>عملیات</th>
          </tr>
        </thead>
        <tbody id="cart-table"></tbody>
      </table>
      <h4 id="total-price"></h4>

      <div class="d-flex justify-content-end mt-3">
        <a href="checkout.html" class="btn btn-success">ادامه ثبت سفارش</a>
      </div>
    </div>

    <script>
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const table = document.getElementById("cart-table");
      const totalPriceEl = document.getElementById("total-price");

      function renderCart() {
        table.innerHTML = "";
        let total = 0;

        if (cart.length === 0) {
          table.innerHTML = `
            <tr>
              <td colspan="5" class="text-center">سبد خرید شما خالی است.</td>
            </tr>
          `;
          totalPriceEl.innerText = "";
          return;
        }

        cart.forEach((p) => {
          const rowTotal = p.price * p.qty;
          total += rowTotal;

          table.innerHTML += `
            <tr>
              <td>${p.name}</td>
              <td>
                <input 
                  type="number" 
                  min="1" 
                  value="${p.qty}" 
                  onchange="updateQty(${p.id}, this.value)" 
                  style="width: 60px;"
                />
              </td>
              <td>${p.price.toLocaleString()} تومان</td>
              <td>${rowTotal.toLocaleString()} تومان</td>
              <td>
                <button 
                  class="btn btn-danger btn-sm" 
                  onclick="removeFromCart(${p.id})"
                >
                  حذف
                </button>
              </td>
            </tr>
          `;
        });

        totalPriceEl.innerText = "جمع کل: " + total.toLocaleString() + " تومان";
      }

      function removeFromCart(id) {
        cart = cart.filter((item) => item.id !== id);
        localStorage.setItem("cart", JSON.stringify(cart));
        renderCart();
      }

      function updateQty(id, newQty) {
        const product = cart.find((item) => item.id === id);
        if (product) {
          const qty = parseInt(newQty);
          if (qty > 0) {
            product.qty = qty;
          } else {
            // اگر تعداد کمتر از 1 وارد شد، حداقل 1 در نظر بگیر
            product.qty = 1;
          }
          localStorage.setItem("cart", JSON.stringify(cart));
          renderCart();
        }
      }

      // اجرای اولیه رندر سبد خرید
      renderCart();
    </script>
  </body>
</html>
